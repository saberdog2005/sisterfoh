<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sister Bar Register</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #1a1a1a; color: #e0e0e0; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .toggle-section { display: flex; align-items: center; gap: 10px; }
        .container { display: flex; flex-direction: column; gap: 20px; max-width: 800px; margin: auto; }
        .button-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .item-btn { padding: 15px; font-size: 16px; background-color: #333; color: #e0e0e0; border: none; border-radius: 5px; cursor: pointer; }
        .item-btn:hover { background-color: #555; }
        .item-btn.active { background-color: #777; }
        .totals-container { display: flex; justify-content: space-between; font-size: 18px; }
        .note-section { display: flex; flex-direction: column; }
        #noteInput { width: 100%; height: 60px; margin-top: 5px; background-color: #333; color: #e0e0e0; border: 1px solid #555; border-radius: 5px; padding: 10px; }
        #logSaleBtn { padding: 15px; font-size: 18px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #logSaleBtn:disabled { background-color: #666; cursor: not-allowed; }
        #message { margin-top: 10px; font-size: 16px; }
        .toggle-btn { padding: 10px 20px; background-color: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .toggle-btn.active { background-color: #f44336; }
    </style>
</head>
<body>
    <div class="header">
        <div id="sessionInfo">
            <label for="eventDate">Date:</label><input type="date" id="eventDate">
            <label for="eventVenue">Venue:</label><input type="text" id="eventVenue" value="Sister">
            <label for="eventName">Event Name:</label><input type="text" id="eventName" value="Open Mic">
        </div>
        <div class="toggle-section">
            <label for="cashierName">Cashier Name:</label><input type="text" id="cashierName" value="Default">
            <button id="toggleSalesBtn" class="toggle-btn">Open Sales</button>
        </div>
    </div>
    <div class="container">
        <div class="button-container">
            <button class="item-btn" data-type="CASH" data-price="10.00">Well ($10)</button>
            <button class="item-btn" data-type="CASH" data-price="12.00">Call ($12)</button>
            <button class="item-btn" data-type="CASH" data-price="14.00">Premium ($14)</button>
            <button class="item-btn" data-type="CASH" data-price="6.00">Beer ($6)</button>
            <button class="item-btn" data-type="CARD" data-price="10.00">Well Card ($10)</button>
            <button class="item-btn" data-type="CARD" data-price="12.00">Call Card ($12)</button>
            <button class="item-btn" data-type="CARD" data-price="14.00">Premium Card ($14)</button>
            <button class="item-btn" data-type="CARD" data-price="6.00">Beer Card ($6)</button>
            <button class="item-btn" data-type="COMP" data-price="0.00">Comp Drink</button>
            <button class="item-btn" data-type="Tickets" data-price="0.00">Ticket</button>
        </div>
        <div class="totals-container">
            <div class="cash-total">Cash Total: $<span id="cashTotal">0.00</span></div>
            <div class="door-count">Thru Door: <span id="doorCount">0</span></div>
        </div>
        <div class="note-section">
            <label for="noteInput">Add a note...</label>
            <textarea id="noteInput" placeholder="Add a note..."></textarea>
        </div>
        <button id="logSaleBtn" disabled>Log Sale</button>
        <div id="message" class="message"></div>
    </div>
    <script>
        // Replace with your Google Apps Script web app URL after deploying the script
        const WEB_APP_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

        class SalesApp {
            constructor() {
                this.items = [];
                this.doorCount = 0;
                this.isSalesActive = false;
            }

            init() {
                this.bindEvents();
                this.updateDate();
            }

            bindEvents() {
                $('.item-btn').on('click', (e) => this.addItem(e));
                $('#toggleSalesBtn').on('click', () => this.toggleSales());
                $('#logSaleBtn').on('click', () => this.logSale());
            }

            updateDate() {
                const today = new Date().toISOString().split('T')[0];
                $('#eventDate').val(today);
            }

            addItem(e) {
                if (!this.isSalesActive) return;
                const $btn = $(e.target);
                const type = $btn.data('type');
                const price = parseFloat($btn.data('price'));
                const name = $btn.text();
                if (type === 'Tickets') {
                    this.doorCount++;
                    $('#doorCount').text(this.doorCount);
                } else {
                    this.items.push({ name, type, price, quantity: 1 });
                }
                this.updateTotals();
                $btn.addClass('active');
                setTimeout(() => $btn.removeClass('active'), 200);
            }

            updateTotals() {
                const cashTotal = this.items.filter(item => item.type === 'CASH')
                    .reduce((sum, item) => sum + (item.price * item.quantity), 0);
                $('#cashTotal').text(cashTotal.toFixed(2));
                $('#logSaleBtn').prop('disabled', this.items.length === 0 && this.doorCount === 0);
            }

            toggleSales() {
                this.isSalesActive = !this.isSalesActive;
                const $btn = $('#toggleSalesBtn');
                $btn.text(this.isSalesActive ? 'Close Sales' : 'Open Sales');
                $btn.toggleClass('active', this.isSalesActive);
                $('#message').text(this.isSalesActive ? 'Sales are now open!' : '');
            }

            async logSale() {
                if (!this.isSalesActive || (this.items.length === 0 && this.doorCount === 0)) return;
                const sessionId = `${$('#eventDate').val()}-${$('#eventVenue').val()}-${$('#eventName').val()}-${$('#cashierName').val()}`;
                const total = this.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const payload = {
                    type: 'TRANSACTION',
                    sessionId: sessionId,
                    timestamp: new Date().toISOString(),
                    time: new Date().toLocaleTimeString(),
                    itemList: JSON.stringify(this.items),
                    total: total.toFixed(2),
                    note: $('#noteInput').val().trim(),
                    doorCount: this.doorCount
                };
                try {
                    await this.sendPostRequest(payload);
                    $('#message').text('Sale logged successfully!');
                    this.resetSale();
                } catch (error) {
                    $('#message').text('Error logging sale: ' + error.message);
                }
            }

            async sendPostRequest(data) {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            }

            resetSale() {
                this.items = [];
                this.doorCount = 0;
                $('#cashTotal').text('0.00');
                $('#doorCount').text('0');
                $('#noteInput').val('');
                $('#logSaleBtn').prop('disabled', true);
            }
        }

        const app = new SalesApp();
        $(document).ready(() => app.init());
    </script>
</body>
</html>
