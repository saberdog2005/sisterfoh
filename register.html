<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sister Bar Register</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1C2526;
            color: #FFFFFF;
            font-size: 16px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #2F3A40;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .header {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .header label {
            display: flex;
            flex-direction: column;
            font-size: 14px;
        }
        .header input {
            padding: 8px;
            background: #666666;
            color: #FFFFFF;
            border: 1px solid #000000;
            border-radius: 4px;
            font-size: 14px;
        }
        .transaction-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #FFFFFF;
            text-align: center;
        }
        .cash-btn { background: #28A745; }
        .cc-btn { background: #DC3545; }
        .ticket-btn { background: #007BFF; }
        .comp-btn { background: #FD7E14; }
        .custom-cash input {
            width: 100%;
            padding: 8px;
            background: #666666;
            color: #FFFFFF;
            border: 1px solid #000000;
            border-radius: 4px;
            font-size: 14px;
        }
        .custom-cash button { 
            background: #28A745; 
            margin-top: 5px; 
            width: 100%;
        }
        .summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        #doorCount { color: #FFFFFF; }
        .note-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #noteInput {
            width: 100%;
            height: 80px;
            padding: 10px;
            background: #666666;
            color: #FFFFFF;
            border: 1px solid #000000;
            border-radius: 4px;
            font-size: 14px;
        }
        #openSalesBtn, #logSaleBtn { background: #28A745; }
        #closeSalesBtn { background: #DC3545; }
        .pin-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2F3A40;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            color: #FFFFFF;
            text-align: center;
        }
        .pin-modal input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #666666;
            color: #FFFFFF;
            border: 1px solid #000000;
            border-radius: 4px;
            font-size: 14px;
        }
        .pin-modal button {
            background: #28A745;
            padding: 10px;
            width: 100%;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div id="nameEntry" class="header">
            <label>Cashier Name: <input type="text" id="cashierNameInput" placeholder="Enter your name"></label>
            <button id="openSalesBtn">Open Sales</button>
        </div>
        <div id="salesInterface" class="hidden">
            <div class="header hidden" id="salesHeader">
                <label>Date: <input type="date" id="sessionDate"></label>
                <label>Venue: <input type="text" id="sessionVenue" value="Sister"></label>
                <label>Event: <input type="text" id="sessionEvent" value="Open Mic"></label>
                <label>Cashier: <input type="text" id="sessionCashier" readonly></label>
                <button id="closeSalesBtn">Close Sales</button>
            </div>
            <div class="transaction-grid" id="transactionGrid">
                <button class="cash-btn" data-type="cash" data-amount="20">$20</button>
                <button class="cash-btn" data-type="cash" data-amount="15">$15</button>
                <button class="cash-btn" data-type="cash" data-amount="12">$12</button>
                <button class="cash-btn" data-type="cash" data-amount="10">$10</button>
                <button class="cash-btn" data-type="cash" data-amount="7">$7</button>
                <button class="cash-btn" data-type="cash" data-amount="5">$5</button>
                <button class="cc-btn" data-type="card" data-amount="0">CC TRANS</button>
                <button class="ticket-btn" data-type="ticket" data-amount="0">TICKET</button>
                <button class="comp-btn" data-type="comp" data-amount="0">COMP</button>
                <div class="custom-cash">
                    <input type="number" id="customCashInput" placeholder="Custom Amount">
                    <button id="addCustomCashBtn">Add</button>
                </div>
            </div>
            <div class="summary">
                <div>Cash Total: $<span id="cashTotal">0.00</span></div>
                <div>Thru Door: <span id="doorCount">0</span></div>
            </div>
            <div class="note-section">
                <textarea id="noteInput" placeholder="Add a note..."></textarea>
                <button id="logSaleBtn">Log Sale</button>
            </div>
        </div>
        <div id="pinModal" class="pin-modal hidden">
            <h2>Enter PIN to Close Sales</h2>
            <input type="password" id="pinInput" placeholder="PIN">
            <button id="confirmCloseBtn">Confirm</button>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '1dJ0NuByJCDgnIRKhsmKrWFyBtCHRgR7ujfGDRb9jhMY';
        const CLIENT_ID = '251850742586-mqcsongr4qc28peshpejmhd5iuiak835.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAS_wlduCCcRSDA3Hjt3hMPRg3olegY2Ic';
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        const PIN = '1234';

        class SalesApp {
            constructor() {
                this.cart = [];
                this.sessionId = '';
                this.doorCount = 0;
                this.cashTotal = 0;
                this.salesOpen = false;
                this.initUI();
                this.bindEvents();
            }

            initUI() {
                $('#nameEntry').removeClass('hidden');
                $('#salesInterface').addClass('hidden');
                $('#sessionDate').val(new Date().toISOString().split('T')[0]);
            }

            bindEvents() {
                $('#openSalesBtn').on('click', () => this.openSales());
                $('#closeSalesBtn').on('click', () => $('#pinModal').removeClass('hidden'));
                $('#confirmCloseBtn').on('click', () => this.closeSales());
                $('.cash-btn, .cc-btn, .ticket-btn, .comp-btn').on('click', function() {
                    const type = $(this).data('type');
                    const amount = parseFloat($(this).data('amount'));
                    app.addTransaction(type, amount);
                });
                $('#addCustomCashBtn').on('click', () => {
                    const amount = parseFloat($('#customCashInput').val());
                    if (!isNaN(amount) && amount > 0) {
                        app.addTransaction('cash', amount);
                        $('#customCashInput').val('');
                    }
                });
                $('#logSaleBtn').on('click', () => this.logSale());
            }

            openSales() {
                const name = $('#cashierNameInput').val().trim();
                if (!name) {
                    alert('Please enter your name.');
                    return;
                }
                this.salesOpen = true;
                $('#sessionCashier').val(name);
                $('#nameEntry').addClass('hidden');
                $('#salesInterface').removeClass('hidden');
                $('#salesHeader').addClass('hidden');
                this.startSession();
            }

            closeSales() {
                if ($('#pinInput').val() !== PIN) {
                    alert('Invalid PIN. Please enter 1234.');
                    return;
                }
                this.salesOpen = false;
                this.endSession();
                $('#salesInterface').addClass('hidden');
                $('#nameEntry').removeClass('hidden');
                $('#cashierNameInput').val('');
                $('#pinModal').addClass('hidden');
                this.cart = [];
                this.cashTotal = 0;
                this.doorCount = 0;
                this.updateDisplay();
            }

            startSession() {
                const date = $('#sessionDate').val();
                const venue = $('#sessionVenue').val().trim();
                const event = $('#sessionEvent').val().trim();
                const cashier = $('#sessionCashier').val();
                this.sessionId = `${date}_${venue}_${event}_${cashier}`;
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: { values: [['SALES OPEN', this.sessionId, new Date().toISOString()]] }
                }).then(() => console.log('Session started'));
            }

            endSession() {
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: { values: [['CLOSED', this.sessionId, new Date().toISOString()]] }
                }).then(() => console.log('Session closed'));
            }

            addTransaction(type, amount) {
                if (!this.salesOpen) {
                    alert('Sales are not open.');
                    return;
                }
                this.cart.push({ type, amount });
                if (type === 'cash') this.cashTotal += amount;
                this.doorCount++;
                this.updateDisplay();
            }

            logSale() {
                if (!this.salesOpen) {
                    alert('Sales are not open.');
                    return;
                }
                if (!this.cart.length) {
                    alert('No transactions to log.');
                    return;
                }
                const timestamp = new Date().toISOString();
                const note = $('#noteInput').val().trim();
                const itemsJson = JSON.stringify(this.cart);
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [['TRANSACTION', this.sessionId, timestamp, timestamp.slice(11, 19), itemsJson, this.cashTotal.toFixed(2), note, this.doorCount]]
                    }
                }).then(() => {
                    this.cart = [];
                    this.cashTotal = 0;
                    this.doorCount = 0;
                    $('#noteInput').val('');
                    this.updateDisplay();
                }).catch(err => console.error('Log failed:', err));
            }

            updateDisplay() {
                $('#cashTotal').text(this.cashTotal.toFixed(2));
                $('#doorCount').text(this.doorCount);
            }
        }

        const app = new SalesApp();

        function handleClientLoad() {
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: DISCOVERY_DOCS
                }).then(() => console.log('Google API initialized'));
            });
        }

        $(document).ready(() => {
            handleClientLoad();
        });
    </script>
</body>
</html>
