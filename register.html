<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Register</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* Dark Theme and General Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #e0e0e0;
            font-size: 18px;
        }
        .container {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            max-width: 1024px;
            margin: 0 auto;
        }
        /* Header Section */
        .header {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .header label {
            display: flex;
            flex-direction: column;
        }
        .header input {
            padding: 8px;
            background: #34495e;
            color: #e0e0e0;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }
        /* Transaction Buttons Grid */
        .transaction-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .cash-btn {
            background: #4CAF50; /* Green */
            color: white;
        }
        .cc-btn {
            background: #d32f2f; /* Red */
            color: white;
        }
        .ticket-btn {
            background: #1a73e8; /* Blue */
            color: white;
        }
        .comp-btn {
            background: #ffa500; /* Orange */
            color: white;
        }
        .custom-cash {
            display: flex;
            gap: 5px;
        }
        .custom-cash input {
            flex: 1;
            padding: 10px;
            background: #34495e;
            color: #e0e0e0;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }
        /* Summary Section */
        .summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 20px;
        }
        #doorCount {
            color: #800080; /* Purple for "Thru Door" */
            font-weight: bold;
        }
        /* Note and Log Sale Section */
        .note-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #noteInput {
            width: 100%;
            height: 100px;
            padding: 10px;
            background: #34495e;
            color: #e0e0e0;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }
        #logSaleBtn {
            background: #4CAF50;
            color: white;
            padding: 10px;
        }
        /* Responsive Design */
        @media (max-width: 768px) {
            .transaction-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <label>Date: <input type="date" id="sessionDate"></label>
            <label>Venue: <input type="text" id="sessionVenue" placeholder="Venue"></label>
            <label>Event: <input type="text" id="sessionEvent" placeholder="Event"></label>
            <label>Cashier: <input type="text" id="sessionCashier" placeholder="Cashier"></label>
            <button id="toggleSalesBtn">Open Sales</button>
        </div>
        <!-- Transaction Buttons Grid -->
        <div class="transaction-grid">
            <button class="cash-btn" data-amount="20">$20</button>
            <button class="cash-btn" data-amount="15">$15</button>
            <button class="cash-btn" data-amount="12">$12</button>
            <button class="cash-btn" data-amount="10">$10</button>
            <button class="cash-btn" data-amount="7">$7</button>
            <button class="cash-btn" data-amount="5">$5</button>
            <button class="cc-btn">CC TRANS</button>
            <button class="ticket-btn">TICKET</button>
            <button class="comp-btn">COMP</button>
            <div class="custom-cash">
                <input type="number" id="customCashInput" placeholder="Custom Amount">
                <button id="addCustomCashBtn">Add</button>
            </div>
        </div>
        <!-- Summary Section -->
        <div class="summary">
            <div>Cash Total: $<span id="cashTotal">0.00</span></div>
            <div>Thru Door: <span id="doorCount">0</span></div>
        </div>
        <!-- Note and Log Sale Section -->
        <div class="note-section">
            <textarea id="noteInput" placeholder="Add a note..."></textarea>
            <button id="logSaleBtn">Log Sale</button>
        </div>
    </div>
    <script>
        // Google Sheets API Configuration with Persistent IDs
        const SPREADSHEET_ID = '1dJ0NuByJCDgnIRKhsmKrWFyBtCHRgR7ujfGDRb9jhMY';
        const CLIENT_ID = '251850742586-mqcsongr4qc28peshpejmhd5iuiak835.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAS_wlduCCcRSDA3Hjt3hMPRg3olegY2Ic';
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

        class SalesApp {
            constructor() {
                this.cart = [];
                this.sessionId = '';
                this.doorCount = parseInt(localStorage.getItem('doorCount') || '0');
                this.cashTotal = 0;
                this.updateDisplay();
            }

            startSession(date, venue, event, cashier) {
                this.sessionId = `${date}_${venue}_${event}_${cashier}`;
                localStorage.setItem('sessionId', this.sessionId);
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: { values: [['SALES OPEN', this.sessionId, new Date().toISOString()]] }
                }).then(() => {
                    $('#toggleSalesBtn').text('Close Sales').css('background', '#e74c3c');
                });
            }

            endSession() {
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: { values: [['CLOSED', this.sessionId, new Date().toISOString()]] }
                }).then(() => {
                    localStorage.removeItem('sessionId');
                    localStorage.setItem('doorCount', '0');
                    this.sessionId = '';
                    this.doorCount = 0;
                    this.cart = [];
                    this.cashTotal = 0;
                    this.updateDisplay();
                    $('#toggleSalesBtn').text('Open Sales').css('background', '#4CAF50');
                });
            }

            addCashTransaction(amount) {
                this.cart.push({ type: 'cash', amount });
                this.cashTotal += amount;
                this.doorCount++;
                this.updateDisplay();
            }

            addCustomCashTransaction(amount) {
                if (!isNaN(amount) && amount > 0) {
                    this.cart.push({ type: 'cash', amount });
                    this.cashTotal += amount;
                    this.doorCount++;
                    this.updateDisplay();
                }
            }

            addCcTransaction() {
                this.cart.push({ type: 'cc' });
                this.doorCount++;
                this.updateDisplay();
            }

            addTicketTransaction() {
                this.cart.push({ type: 'ticket' });
                this.doorCount++;
                this.updateDisplay();
            }

            addCompTransaction() {
                this.cart.push({ type: 'comp' });
                this.doorCount++;
                this.updateDisplay();
            }

            logSale() {
                if (!this.cart.length || !this.sessionId) return;
                const timestamp = new Date().toISOString();
                const note = $('#noteInput').val().trim();
                const itemsJson = JSON.stringify(this.cart);
                gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Sheet1!A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [['TRANSACTION', this.sessionId, timestamp, timestamp.slice(11, 19), itemsJson, this.cashTotal.toFixed(2), note, this.doorCount]]
                    }
                }).then(() => {
                    this.cart = [];
                    this.cashTotal = 0;
                    $('#noteInput').val('');
                    this.updateDisplay();
                });
            }

            updateDisplay() {
                $('#cashTotal').text(this.cashTotal.toFixed(2));
                $('#doorCount').text(this.doorCount);
                localStorage.setItem('doorCount', this.doorCount);
            }
        }

        const app = new SalesApp();

        function handleClientLoad() {
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: DISCOVERY_DOCS
                }).then(() => {
                    if (localStorage.getItem('sessionId')) {
                        app.sessionId = localStorage.getItem('sessionId');
                        $('#toggleSalesBtn').text('Close Sales').css('background', '#e74c3c');
                    }
                });
            });
        }

        $(document).ready(() => {
            handleClientLoad();
            $('#toggleSalesBtn').on('click', () => {
                if (app.sessionId) {
                    app.endSession();
                } else {
                    const date = $('#sessionDate').val();
                    const venue = $('#sessionVenue').val().trim();
                    const event = $('#sessionEvent').val().trim();
                    const cashier = $('#sessionCashier').val().trim();
                    if (date && venue && event && cashier) app.startSession(date, venue, event, cashier);
                }
            });
            $('.cash-btn').on('click', function() {
                const amount = parseFloat($(this).data('amount'));
                app.addCashTransaction(amount);
            });
            $('#addCustomCashBtn').on('click', () => {
                const amount = parseFloat($('#customCashInput').val());
                app.addCustomCashTransaction(amount);
                $('#customCashInput').val('');
            });
            $('.cc-btn').on('click', () => app.addCcTransaction());
            $('.ticket-btn').on('click', () => app.addTicketTransaction());
            $('.comp-btn').on('click', () => app.addCompTransaction());
            $('#logSaleBtn').on('click', () => app.logSale());
        });
    </script>
</body>
</html>
