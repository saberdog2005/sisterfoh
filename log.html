<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1 brighten;
    <title>Register</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1e1e1e;
            color: #e0e0e0;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #2d2d2d;
            padding: 20px;
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        .register-btn {
            padding: 15px 30px;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 16px;
            width: 120px;
            text-align: center;
        }
        .cash-btn { background-color: #4caf50; }
        .cc-btn { background-color: #f44336; }
        .ticket-btn { background-color: #2196f3; }
        .comp-btn { background-color: #ff9800; }
        .counts {
            margin-top: 20px;
        }
        .count-item {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Register</h1>
        <div class="button-container">
            <button class="register-btn cash-btn" data-type="CASH" data-value="5">Cash ($5)</button>
            <button class="register-btn cc-btn" data-type="CC TRANS" data-value="6">CC ($6)</button>
            <button class="register-btn ticket-btn" data-type="TICKET" data-value="10">Ticket ($10)</button>
            <button class="register-btn comp-btn" data-type="COMP" data-value="0">Comp ($0)</button>
        </div>
        <div class="counts">
            <div class="count-item cash">Cash Count: <span id="cashCount">0</span></div>
            <div class="count-item cc">CC Count: <span id="ccCount">0</span></div>
            <div class="count-item ticket">Ticket Count: <span id="ticketCount">0</span></div>
            <div class="count-item comp">Comp Count: <span id="compCount">0</span></div>
        </div>
    </div>

    <script>
        const channel = new BroadcastChannel('transaction_channel');
        const counts = {
            CASH: 0,
            'CC TRANS': 0,
            TICKET: 0,
            COMP: 0
        };

        function updateCounts() {
            document.getElementById('cashCount').textContent = counts.CASH;
            document.getElementById('ccCount').textContent = counts['CC TRANS'];
            document.getElementById('ticketCount').textContent = counts.TICKET;
            document.getElementById('compCount').textContent = counts.COMP;
        }

        $('.register-btn').on('click', function() {
            const type = $(this).data('type');
            const value = parseFloat($(this).data('value'));
            counts[type]++;

            const transaction = {
                id: Date.now(),
                sessionId: localStorage.getItem('activeSessionId') || 'default_session',
                timestamp: new Date().toISOString(),
                cashierName: 'Cashier1',
                items: `${type}: 1 @ $${value.toFixed(2)}`,
                cashTotal: value,
                doorCount: 1,
                note: ''
            };

            const dbRequest = indexedDB.open('SalesDB', 2);
            dbRequest.onsuccess = (event) => {
                const db = event.target.result;
                const tx = db.transaction(['transactions'], 'readwrite');
                const store = tx.objectStore('transactions');
                store.put(transaction);
                tx.oncomplete = () => {
                    channel.postMessage({ type: 'new_transaction', data: transaction });
                    updateCounts();
                };
            };
            dbRequest.onerror = (event) => console.error('Database error:', event.target.error);
        });

        // Initial count update
        updateCounts();
    </script>
</body>
</html>
