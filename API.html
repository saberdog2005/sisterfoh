<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Handler</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1>API Handler</h1>
    <p>This page handles API requests for register.html and log.html.</p>
    <script>
        const API_KEY = 'AIzaSyAS_wlduCCcRSDA3Hjt3hMPRg3olegY2Ic';
        const WEB_APP_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL'; // Replace with your Web App URL

        // Function to send data to Google Apps Script Web App (fallback)
        function sendToGoogleSheet(data) {
            fetch(WEB_APP_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Data sent to Google Sheet:', result);
            })
            .catch(error => {
                console.error('Error sending to Google Sheet:', error);
            });
        }

        // Example function to handle incoming requests (e.g., from register.html)
        function handleTransaction(transaction) {
            sendToGoogleSheet(transaction);
        }

        // For future Google Sheets API integration with OAuth
        /*
        function initClient() {
            gapi.load('client:auth2', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                    scope: 'https://www.googleapis.com/auth/spreadsheets'
                }).then(() => {
                    console.log('Google API Client initialized');
                }).catch(error => {
                    console.error('Error initializing Google API Client:', error);
                });
            });
        }

        function appendToSheet(data) {
            gapi.client.sheets.spreadsheets.values.append({
                spreadsheetId: '1dJ0NuByJCDgnIRKhsmKrWFyBtCHRgR7ujfGDRb9jhMY',
                range: 'LIVE REGISTER!A:G',
                valueInputOption: 'RAW',
                resource: {
                    values: [[
                        data.sessionId,
                        data.timestamp,
                        data.time,
                        data.itemList.map(item => `${item.item} (x${item.quantity})`).join(', '),
                        data.total,
                        data.note,
                        data.doorCount
                    ]]
                }
            }).then(response => {
                console.log('Data appended to Google Sheet:', response);
            }).catch(error => {
                console.error('Error appending to Google Sheet:', error);
            });
        }
        */
    </script>
</body>
</html>
